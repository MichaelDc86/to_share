# Апи для вычисления квадратного корня

## 1. Установка
* Установить [poetry](https://python-poetry.org/docs/#installation)

* Установить зависимости для разработки:

    ```sh
    poetry install
    ```
* активировать окружение
    ```sh
    poetry shell
    ```

## 3. Запуск API
#### Проект должен быть на всех 3 машинах, и установка поетри-зависимостей тоже должна быть произведена
#### На 1 машине:
    ```sh
    poetry run uvicorn rest_app:app --host=127.0.0.1 --port=8000
    ```
    redis(broker) - указать REDIS_DC_FILE путь до композа редиса
    ```
    docker-compose -f $(REDIS_DC_FILE)
    ```

## 4. Запуск Celery воркеров на 2 осталвшихся машинах(выполнить на каждой машине)

* ```
  celery -A celery_app worker -l info --concurrency=2
  ```

## Дока(свыагер)
```http://127.0.0.1:8000/docs```

#### Комментарии
* На 1-ой машине крутится приложение апи и редис в контейнере(можно запустиь на отдельной машине, нужно просто\
  в конфиге тогда поправить хосты). Апишка складывает задачи в редис, воркеры разгребают

* на 2 других машинах запускаются по воркеру на каждой, каждый воркер с 2 потоками, они забирают задачи\
из брокера и возвращают результат в апишку
  
* апишка асинхронно возвращает джейсон ответ.

P.S. писать общий композ или ansyble - долго. писать перехватчик логов от селери и редиса тоже небыстро, поэтому  эти\
фичи здесь отсутствуют. Набросал композ и докерфайл, но там не настраивал(это время!).